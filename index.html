<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@hanser/z-axis | Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #050505; --bg-panel: #0f0f0f; --accent: #00ff9d; --border: #222; --text-muted: #666; }
        body { background: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        input[type=range] { -webkit-appearance: none; -moz-appearance: none; appearance: none; background: transparent; width: 100%; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: var(--accent); margin-top: -5px; cursor: pointer; box-shadow: 0 0 10px var(--accent); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border-radius: 2px; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .stage { perspective: 1200px; transform-style: preserve-3d; }
        .grid-bg { background-image: radial-gradient(#333 1px, transparent 1px); background-size: 40px 40px; mask-image: radial-gradient(circle at center, black 30%, transparent 80%); }
        
        /* TEXTURES */
        .texture-glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.05); }
        .texture-metal { background: linear-gradient(145deg, #1a1a1a, #050505); border: 1px solid #333; }
        .texture-neon { background: #000; border: 1px solid var(--accent); box-shadow: 0 0 50px rgba(0, 255, 157, 0.1); }
    </style>
</head>
<body class="flex h-screen w-screen">

    <!-- SETTINGS PANEL -->
    <aside class="w-96 bg-[var(--bg-panel)] border-r border-[var(--border)] flex flex-col z-20 shadow-2xl relative">
        <div class="p-6 border-b border-[var(--border)]">
            <h1 class="text-xl font-bold tracking-tighter flex items-center gap-2">
                <span class="w-3 h-3 bg-[var(--accent)] rounded-full shadow-[0_0_10px_var(--accent)]"></span>
                @hanser/z-axis
            </h1>
            <p class="text-xs text-[var(--text-muted)] mt-1">v1.1.0 â€¢ Studio & Gyro</p>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-8 hide-scrollbar">
            
            <!-- 1. MOBILE TRIGGER -->
            <div class="bg-gradient-to-r from-[var(--accent)] to-emerald-600 p-[1px] rounded-lg">
                <button id="btn-mobile" class="w-full bg-black hover:bg-opacity-90 text-white text-xs font-bold py-3 rounded-md transition-all flex items-center justify-center gap-2 group">
                    <svg class="w-4 h-4 text-[var(--accent)] group-hover:rotate-12 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                    ACTIVATE MOBILE GYRO
                </button>
            </div>

            <!-- 2. LAYOUT -->
            <div class="space-y-3">
                <label class="text-[10px] font-bold text-[var(--text-muted)] uppercase tracking-widest">Layout View</label>
                <div class="grid grid-cols-2 gap-2">
                    <button id="view-card" class="preset-btn p-2 text-xs border border-[var(--accent)] text-[var(--accent)] rounded transition-all">Standard Card</button>
                    <button id="view-story" class="preset-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded transition-all">Vertical Story</button>
                </div>
            </div>

            <hr class="border-[var(--border)]">

            <!-- 3. PRESETS -->
            <div class="space-y-3">
                <label class="text-[10px] font-bold text-[var(--text-muted)] uppercase tracking-widest">Theme</label>
                <div class="grid grid-cols-3 gap-2">
                    <button id="btn-glass" class="theme-btn p-2 text-xs border border-[var(--accent)] text-[var(--accent)] rounded transition-all">Glass</button>
                    <button id="btn-metal" class="theme-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded hover:text-white transition-all">Metal</button>
                    <button id="btn-neon" class="theme-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded hover:text-white transition-all">Neon</button>
                </div>
            </div>

            <hr class="border-[var(--border)]">
            
            <!-- 4. PHYSICS CONTROLS -->
            <div class="space-y-6">
                <!-- Force Slider -->
                <div>
                    <div class="flex justify-between text-[10px] uppercase font-bold text-[var(--text-muted)] mb-2">
                        <span>Tilt Sensitivity</span>
                        <span id="val-force" class="text-[var(--accent)]">30deg</span>
                    </div>
                    <input type="range" id="inp-force" min="10" max="80" value="30">
                </div>

                <!-- Physics Mode -->
                <div>
                    <label class="text-[10px] font-bold text-[var(--text-muted)] uppercase tracking-widest mb-2 block">Physics Mode</label>
                    <div class="flex gap-2 bg-black p-1 rounded border border-[var(--border)]">
                        <button id="mode-heavy" class="flex-1 text-xs py-2 rounded bg-[#222] text-white transition-all">Heavy (Lerp)</button>
                        <button id="mode-instant" class="flex-1 text-xs py-2 rounded text-[#666] hover:text-white transition-all">Instant</button>
                    </div>
                </div>
            </div>

            <!-- 5. TOGGLES -->
            <div class="space-y-3 pt-2">
                <label class="flex items-center justify-between cursor-pointer group">
                    <span class="text-xs text-gray-400 group-hover:text-white transition-colors">Holographic Glare</span>
                    <input type="checkbox" id="inp-glare" checked class="accent-[var(--accent)]">
                </label>
                <label class="flex items-center justify-between cursor-pointer group">
                    <span class="text-xs text-gray-400 group-hover:text-white transition-colors">Reverse Axis</span>
                    <input type="checkbox" id="inp-reverse" class="accent-[var(--accent)]">
                </label>
            </div>

        </div>

        <!-- 6. CODE EXPORT -->
        <div class="p-6 bg-black border-t border-[var(--border)]">
            <div class="flex justify-between items-center mb-2">
                <label class="text-[10px] font-bold text-[var(--text-muted)] uppercase">Install & Usage</label>
                <button id="btn-copy" class="text-[var(--accent)] text-[10px] uppercase font-bold hover:underline">Copy</button>
            </div>
            <div class="relative">
                <pre class="mono text-[10px] text-gray-500 bg-[#111] p-3 rounded border border-[var(--border)] overflow-x-auto"><code id="code-output">...</code></pre>
                <div id="copy-toast" class="absolute inset-0 flex items-center justify-center bg-[var(--accent)] text-black font-bold text-xs opacity-0 transition-opacity pointer-events-none rounded">COPIED!</div>
            </div>
        </div>
    </aside>

    <!-- STAGE -->
    <main class="flex-1 relative flex items-center justify-center bg-[#080808] overflow-hidden">
        <div class="absolute inset-0 grid-bg opacity-20"></div>
        
        <div class="stage">
            <!-- Card Container -->
            <div id="demo-card" class="w-[420px] h-[280px] rounded-2xl relative flex flex-col justify-between p-10 transition-all duration-700 ease-[cubic-bezier(0.23,1,0.32,1)]"
                 data-z data-z-force="30" data-z-glare>
                <div id="card-content" class="h-full flex flex-col justify-between pointer-events-none"></div>
            </div>
        </div>

        <!-- Mobile instructions overlay -->
        <div id="mobile-toast" class="absolute top-4 left-1/2 -translate-x-1/2 bg-[var(--accent)] text-black px-4 py-2 rounded font-bold text-xs opacity-0 transition-opacity pointer-events-none">
            GYRO ENABLED: TILT YOUR DEVICE
        </div>
    </main>

    <script>
        // --- EMBEDDED LIBRARY FOR DEMO ---
        const manager = {
            elements: new Set(),
            mouse: { x: 0, y: 0 },
            isGyro: false, // Track state locally for the demo

            init() {
                this.mouseHandler = (e) => {
                    this.mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                    this.mouse.y = (e.clientY / window.innerHeight) * 2 - 1;
                };
                
                // Define gyro handler once so we can add/remove it
                this.gyroHandler = (e) => {
                    const tiltX = e.gamma || 0; 
                    const tiltY = e.beta || 0;
                    this.mouse.x = Math.max(-1, Math.min(1, tiltX / 45));
                    this.mouse.y = Math.max(-1, Math.min(1, (tiltY - 45) / 45));
                };

                window.addEventListener('mousemove', this.mouseHandler);
                
                const loop = () => {
                    this.elements.forEach(el => el.update(this.mouse));
                    requestAnimationFrame(loop);
                };
                requestAnimationFrame(loop);
            },

            gyro() {
                // TOGGLE LOGIC
                if (this.isGyro) {
                    // Deactivate
                    this.isGyro = false;
                    window.removeEventListener('deviceorientation', this.gyroHandler);
                    window.addEventListener('mousemove', this.mouseHandler);
                    
                    // Reset UI
                    document.getElementById('mobile-toast').classList.add('opacity-0');
                    const btn = document.getElementById('btn-mobile');
                    btn.innerHTML = `<svg class="w-4 h-4 text-[var(--accent)] group-hover:rotate-12 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg> ACTIVATE MOBILE GYRO`;
                    btn.classList.remove('text-red-400');
                    return;
                }

                // Activate
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(response => { if (response === 'granted') this.enableGyro(); })
                        .catch(console.error);
                } else {
                    this.enableGyro();
                }
            },

            enableGyro() {
                this.isGyro = true;
                window.removeEventListener('mousemove', this.mouseHandler);
                window.addEventListener('deviceorientation', this.gyroHandler);
                
                // Update UI
                document.getElementById('mobile-toast').classList.remove('opacity-0');
                const btn = document.getElementById('btn-mobile');
                btn.innerHTML = `ðŸ›‘ DEACTIVATE GYRO`;
                btn.classList.add('text-red-400');
            },

            register(el) { this.elements.add(el); }
        };

        class ZElement {
            constructor(el, options = {}) {
                this.el = el;
                this.current = { x: 0, y: 0 };
                
                this.glare = document.createElement('div');
                Object.assign(this.glare.style, {
                    position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',
                    // CHANGED: 'overlay' -> 'screen' (Fixes visibility on dark/black backgrounds)
                    pointerEvents: 'none', mixBlendMode: 'screen', zIndex: 1, borderRadius: 'inherit'
                });
                this.el.appendChild(this.glare);
                this.el.style.transformStyle = 'preserve-3d';

                this.updateOptions(options);
                manager.register(this);
            }

            updateOptions(opts) {
                this.force = parseInt(opts.force) || 30;
                this.mode = opts.mode || 'heavy';
                this.reverse = opts.reverse || false;
                this.hasGlare = opts.glare !== false;
                
                this.glare.style.opacity = this.hasGlare ? 1 : 0;
            }

            update(input) {
                const direction = this.reverse ? 1 : -1;
                const targetX = input.y * this.force * direction;
                const targetY = input.x * this.force * (direction * -1);

                if (this.mode === 'heavy') {
                    this.current.x += (targetX - this.current.x) * 0.08;
                    this.current.y += (targetY - this.current.y) * 0.08;
                } else {
                    this.current.x = targetX;
                    this.current.y = targetY;
                }

                this.el.style.transform = `rotateX(${this.current.x}deg) rotateY(${this.current.y}deg)`;

                if (this.hasGlare) {
                    const gx = (input.x + 1) * 50;
                    const gy = (input.y + 1) * 50;
                    // CHANGED: Increased opacity from 0.3 to 0.4 for better visibility on metal
                    this.glare.style.background = `radial-gradient(circle at ${gx}% ${gy}%, rgba(255,255,255,0.4), transparent 50%)`;
                }
            }
        }

        // --- APP LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            manager.init();
            const card = document.getElementById('demo-card');
            const cardContent = document.getElementById('card-content');
            
            // State
            const state = { force: 30, mode: 'heavy', reverse: false, glare: true, theme: 'glass' };
            const z = new ZElement(card, state);

            // UPDATE FUNCTIONS
            const updateEngine = () => {
                z.updateOptions(state);
                updateCode();
            };

            const updateCode = () => {
                const html = `<!-- npm i @hanser/z-axis -->
<div class="card"
     data-z
     data-z-force="${state.force}"
     data-z-mode="${state.mode}"
     ${state.reverse ? 'data-z-reverse' : ''}
     ${state.glare ? 'data-z-glare' : ''}>
   <!-- Content -->
</div>`;
                document.getElementById('code-output').innerText = html;
            };

            // 1. MOBILE & VIEW
            document.getElementById('btn-mobile').addEventListener('click', () => {
                manager.gyro();
                // Only switch view if activating, not deactivating
                if (manager.isGyro) {
                    setView('story');
                }
            });

            const setView = (type) => {
                const btnCard = document.getElementById('view-card');
                const btnStory = document.getElementById('view-story');
                
                if (type === 'card') {
                    card.style.width = '420px';
                    card.style.height = '280px';
                    btnCard.className = 'preset-btn p-2 text-xs border border-[var(--accent)] text-[var(--accent)] rounded transition-all';
                    btnStory.className = 'preset-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded transition-all';
                } else {
                    card.style.width = '300px';
                    card.style.height = '550px';
                    btnStory.className = 'preset-btn p-2 text-xs border border-[var(--accent)] text-[var(--accent)] rounded transition-all';
                    btnCard.className = 'preset-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded transition-all';
                }
            };
            document.getElementById('view-card').addEventListener('click', () => setView('card'));
            document.getElementById('view-story').addEventListener('click', () => setView('story'));

            // 2. THEMES
            const setTheme = (type) => {
                state.theme = type;
                card.className = ''; // Reset
                card.classList.add('rounded-2xl', 'relative', 'flex', 'flex-col', 'justify-between', 'p-10', 'transition-all', 'duration-700', 'ease-[cubic-bezier(0.23,1,0.32,1)]');
                
                document.querySelectorAll('.theme-btn').forEach(b => b.className = 'theme-btn p-2 text-xs border border-[var(--border)] text-[var(--text-muted)] rounded hover:text-white transition-all');
                document.getElementById('btn-' + type).className = 'theme-btn p-2 text-xs border border-[var(--accent)] text-[var(--accent)] rounded transition-all';

                // Restore dimensions
                const isStory = document.getElementById('view-story').classList.contains('text-[var(--accent)]');
                if(isStory) { card.style.width = '300px'; card.style.height = '550px'; }
                else { card.style.width = '420px'; card.style.height = '280px'; }

                if(type === 'glass') {
                    card.classList.add('texture-glass');
                    cardContent.innerHTML = `<div class="flex justify-between items-start"><div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center backdrop-blur-md"><span class="text-xl">âŒ˜</span></div><span class="text-xs mono text-white/50">@hanser/z-axis</span></div><div><h1 class="text-3xl font-bold tracking-tight text-white mb-2">Glass UI</h1><p class="text-sm text-white/70">Gyro-Enabled Physics</p></div>`;
                } else if(type === 'metal') {
                    card.classList.add('texture-metal');
                    cardContent.innerHTML = `<div class="flex justify-between items-start"><div class="flex gap-2"><div class="w-8 h-8 rounded-full bg-yellow-600"></div><div class="w-8 h-8 rounded-full bg-red-600 -ml-4 mix-blend-lighten"></div></div><span class="text-xs font-bold tracking-widest text-white/40">PLATINUM</span></div><div><h2 class="text-xl mono text-white mb-4 tracking-widest">4500 1234 5678 9000</h2></div>`;
                } else {
                    card.classList.add('texture-neon');
                    cardContent.innerHTML = `<div class="absolute inset-0 border border-[var(--accent)] opacity-20 m-3 rounded-xl"></div><div class="h-full flex flex-col items-center justify-center"><div class="text-6xl mb-4">ðŸ‘¾</div><h1 class="text-4xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent)] to-white">LEVEL 99</h1></div>`;
                }
                
                // Re-apply depth to new content
                setTimeout(() => {
                    const children = cardContent.querySelectorAll('div, h1, h2, span, p');
                    children.forEach(c => c.style.transform = 'translateZ(20px)');
                }, 50);
            };
            
            document.getElementById('btn-glass').addEventListener('click', () => setTheme('glass'));
            document.getElementById('btn-metal').addEventListener('click', () => setTheme('metal'));
            document.getElementById('btn-neon').addEventListener('click', () => setTheme('neon'));

            // 3. CONTROLS
            document.getElementById('inp-force').addEventListener('input', (e) => {
                state.force = e.target.value;
                document.getElementById('val-force').innerText = state.force + 'deg';
                updateEngine();
            });

            const setMode = (mode) => {
                state.mode = mode;
                const heavy = document.getElementById('mode-heavy');
                const instant = document.getElementById('mode-instant');
                if (mode === 'heavy') {
                    heavy.className = "flex-1 text-xs py-2 rounded bg-[#222] text-white transition-all";
                    instant.className = "flex-1 text-xs py-2 rounded text-[#666] hover:text-white transition-all";
                } else {
                    heavy.className = "flex-1 text-xs py-2 rounded text-[#666] hover:text-white transition-all";
                    instant.className = "flex-1 text-xs py-2 rounded bg-[#222] text-white transition-all";
                }
                updateEngine();
            };
            document.getElementById('mode-heavy').addEventListener('click', () => setMode('heavy'));
            document.getElementById('mode-instant').addEventListener('click', () => setMode('instant'));

            document.getElementById('inp-glare').addEventListener('change', (e) => {
                state.glare = e.target.checked;
                updateEngine();
            });

            document.getElementById('inp-reverse').addEventListener('change', (e) => {
                state.reverse = e.target.checked;
                updateEngine();
            });

            document.getElementById('btn-copy').addEventListener('click', () => {
                const code = document.getElementById('code-output').innerText;
                navigator.clipboard.writeText(code);
                document.getElementById('copy-toast').classList.remove('opacity-0');
                setTimeout(() => document.getElementById('copy-toast').classList.add('opacity-0'), 2000);
            });
            
            // Init
            setTheme('glass');
            updateCode();
        });
    </script>
</body>
</html>
